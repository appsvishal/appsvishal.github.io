<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24..48,400,0..1,0"/>
    <style>
        html, body {
            background-color: #f5f6f7;
            font-family: "Inter", sans-serif;
            color: black;
            padding-left: 5px;
            padding-right: 5px;
            margin:0;
            height: 100%;
            overflow: hidden;
        }

        .top-bar { display: flex; justify-content: flex-end; align-items: left; padding:10px 6px 0 6px; }
        .page-tt { font-size: 60px; text-align: left; color: black; margin: 6px 0 10px 6px; }
        .set-ic { font-variation-settings: 'FILL' 1; margin-top: 12px; margin-right: 12px; font-size: 28px; cursor:pointer; }

        .create-circle{
            position:fixed;
            bottom:12px;
            right:12px;
            width:56px;
            height:56px;
            background-color:#2979FF;
            color:white;
            border-radius:50%;
            display:flex;
            justify-content:center;
            box-shadow:0 8px 20px rgba(41,121,255,0.45);
            align-items:center;
            cursor:pointer;
            z-index:1400;
            margin:0;
        }
        .create-ic { font-size:28px; margin:0; pointer-events:none; }

        .search-bar { width: 100%; box-sizing: border-box; background-color: lightgrey; color: grey; padding: 12px; border-radius: 32px; padding-left: 19px; display: flex; align-items: center; gap: 2px; margin-top: 0; }
        .search-ic { vertical-align: center;}

        .bottom-bar-navi{ display:flex; gap:12px; padding:10px; background:white; position:fixed; bottom:12px; left:18px; border-radius:15px; width:fit-content; height:fit-content; box-shadow:0 2px 8px rgba(0,0,0,0.12); z-index:998; }
        .bottom-item{ display:flex; align-items:center; justify-content:center; padding:6px 12px; border-radius:12px; cursor:pointer; gap:6px; }
        .bottom-item.active{ background:#e0e0e0; } 
        .botm-ic{ font-size:32px; color:black; font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0; } 
        .botm-ic-dark{ font-size:32px; color:black; font-variation-settings:'FILL' 1,'wght' 400,'GRAD' 0; } 

        #pageSlide{position:fixed;inset:0;background:#f5f6f7;transform:translateX(100%);z-index:2000;}
        #pageSlide.active{animation:slideR .35s ease forwards}
        @keyframes slideR{to{transform:translateX(0)}}

        /* List container */
        .list-bc {
            background: white;
            border-radius: 22px;
            padding: 10px 20px;
            width: 100%;
            margin-top: 12px;
            box-sizing: border-box;
            max-height: calc(100vh - 320px);
            overflow-y: auto;
        }

        .list-title {
            font-size: 18px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: #222;
        }

        .todo-item{
            display: flex;
            align-items: center;
            gap: 12px;
            background: #f3f4f6;
            border-radius: 12px;
            padding: 10px 12px;
            margin-bottom: 8px;
        }

        .todo-item input[type="checkbox"]{
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .todo-text{
            flex:1;
            font-size: 16px;
            word-break: break-word;
        }

        .remove-btn{
            color: #f44336;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            margin-left: 10px;
        }

        /* Completed box */
        .completed-bc {
            background: white;
            border-radius: 22px;
            padding: 10px 20px;
            width: 100%;
            margin-top: 20px;
            box-sizing: border-box;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }

        /* Shared overlay for bottom popups */
        .popup-overlay{
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease;
            z-index: 1500;
        }
        .popup-overlay.active{ opacity: 1; pointer-events: auto; }

        /* Bottom Popup base */
        .bottom-popup{
    position: fixed;
    left: 12px;
    right: 12px;
    bottom: -100%;
    background: #fff;
    border-radius: 22px;
    padding: 14px;
    box-shadow: 0 -8px 24px rgba(0,0,0,0.18);
    transition: bottom 0.3s ease;
    z-index: 1501;
    padding-right: 25px;
}
        .bottom-popup.active{ bottom: 12px; }

        .popup-handle{
            width: 42px;
            height: 5px;
            background: #ccc;
            border-radius: 10px;
            margin: 6px auto 14px auto;
        }

        .pop-actions { display:flex; justify-content: space-between; align-items:center; gap:10px; margin-bottom: 10px; }
        .pop-txt-b { font-size: 18px; color: #2979FF; font-weight: 600; margin:0; cursor:pointer; user-select:none; }
        .pop-txt-bl { font-size: 18px; color: black; font-weight: 600; margin:0; cursor:pointer; user-select:none; }

        .pop-txt-bx {
            background: #f3f4f6;
            padding: 12px;
            border-radius: 12px;
            color: grey;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
            margin-top: 0;
            border: none;
            outline: none;
        }
        .pop-input{
            width: 100%;
            border: none;
            background: transparent;
            font-size: 16px;
            color: #111;
            outline: none;
        }
        .save-action { color:#2979FF; font-weight:700; cursor:pointer; user-select:none; }

        /* Menu popup items */
        .popup-item{
            padding: 14px;
            font-size: 16px;
            border-radius: 14px;
            cursor: pointer;
            margin: 0;
            line-height: 1;
        }
        .popup-item{
    padding: 14px;
    font-size: 16px;
    border-radius: 14px;
    cursor: pointer;
    margin: 0;          /* remove top/bottom margin */
    line-height: 0.80;   /* reduce extra line spacing */
}
.popup-item-b {color: #2979FF;}
.popup-item + .popup-item {
    margin-top: 0;      /* ensure no spacing between items */
}

.popup-item:hover{
    background: #f2f2f2;
}
        .pop-topbar{
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        .pop-center{
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            margin-top: 6px;
        }

        .pop-right{
            position: absolute;
            right: 0;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <!-- top three dots now opens bottom menu -->
        <span id="topAction" class="material-symbols-outlined set-ic" title="Menu" onclick="openMenuBottomPopup()">more_vert</span>
    </div>

    <p class="page-tt">To-do</p>

    <div class="search-bar" aria-hidden="true">
        <span class="material-symbols-outlined search-ic">search</span>
        <span style="color:grey; margin-left:8px;">Search</span>
    </div>

    <div class="create-circle" title="Add to-do" onclick="openTodoPopup()">
        <span class="material-symbols-outlined create-ic">add_2</span>
    </div>

    <div class="bottom-bar-navi" aria-hidden="true">
        <div class="bottom-item">
            <a href="index.html" style="text-decoration:none;color:inherit;">
                <span class="material-symbols-outlined botm-ic">note_stack</span>
            </a>
        </div>
        <div class="bottom-item active">
            <span class="material-symbols-outlined botm-ic-dark">book_2</span>
            <span class="bottom-label">To-do</span>
        </div>
    </div>

    <!-- Pending todos box -->
    <div class="list-bc" id="todoListBox">
        <p class="list-title">Your todos</p>
        <div id="todoList">
            <!-- pending items injected here -->
        </div>
    </div>

    <!-- Completed box (appears after, margin-top:20px) -->
    <div class="completed-bc" id="completedBox" style="display:none;">
        <p class="list-title">Completed</p>
        <div id="completedList">
            <!-- completed items injected here -->
        </div>
    </div>

    <div id="pageSlide"></div>

    <!-- Single shared overlay for bottom popups -->
    <div class="popup-overlay" id="popupOverlay" onclick="closeBottomPopups()"></div>

    <!-- TODO Bottom Popup -->
    <div class="bottom-popup" id="todoPopup" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="popup-handle"></div>
        <div class="pop-actions">
            <p class="pop-txt-b" onclick="closeBottomPopups()">Close</p>
            <p class="pop-txt-bl">To-do</p>
            <p class="pop-txt-b save-action" id="saveBtn">Save</p>
        </div>
        <div class="pop-txt-bx">
            <input id="todoInput" class="pop-input" type="text" placeholder="Enter your to-do here" />
        </div>
    </div>

    <!-- Menu Bottom Popup (Feedback & About) -->
    <div class="bottom-popup" id="menuBottomPopup" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="popup-handle"></div>

        <div class="pop-topbar">
            <p class="pop-txt-bl pop-center">Menu</p>
            <p class="pop-txt-b pop-right" onclick="closeBottomPopups()">Close</p>
        </div>

        <div class="popup-item" onclick="sendFeedback()">Feedback</div>
        <div class="thin-divider"></div>
        <div class="popup-item popup-item-b" onclick="openAbout()">About</div>
    </div>

    <script>
        // ---------- Popup control ----------
        const popupOverlay = document.getElementById('popupOverlay');
        const todoPopup = document.getElementById('todoPopup');
        const menuBottomPopup = document.getElementById('menuBottomPopup');
        const todoInput = document.getElementById('todoInput');
        const saveBtn = document.getElementById('saveBtn');

        function openTodoPopup(){
            // close other bottom popups first
            menuBottomPopup.classList.remove('active');
            popupOverlay.classList.add('active');
            todoPopup.classList.add('active');
            // focus input after animation
            setTimeout(()=> { todoInput.focus(); }, 240);
        }

        function openMenuBottomPopup(){
            // close other bottom popups first
            todoPopup.classList.remove('active');
            popupOverlay.classList.add('active');
            menuBottomPopup.classList.add('active');
        }

        function closeBottomPopups(){
            popupOverlay.classList.remove('active');
            document.querySelectorAll('.bottom-popup').forEach(p => p.classList.remove('active'));
            if (todoInput) todoInput.blur();
        }

        // ---------- TODO logic (localStorage) ----------
        const TODO_KEY = 'evora_todos_v3';
        function loadTodos(){ const raw = localStorage.getItem(TODO_KEY); try{ return raw ? JSON.parse(raw) : []; }catch(e){ return []; } }
        function saveTodos(arr){ localStorage.setItem(TODO_KEY, JSON.stringify(arr)); }

        function renderAll(){
            const todos = loadTodos();
            const pending = todos.filter(x => !x.done);
            const done = todos.filter(x => x.done);

            const todoList = document.getElementById('todoList');
            const completedList = document.getElementById('completedList');
            todoList.innerHTML = '';
            completedList.innerHTML = '';

            if(pending.length === 0){
                const empty = document.createElement('div');
                empty.className = 'todo-item';
                empty.innerHTML = '<div class="todo-text" style="color:gray">No todos yet. Tap + to add.</div>';
                todoList.appendChild(empty);
            } else {
                pending.forEach((item) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'todo-item';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = false;
                    checkbox.addEventListener('change', ()=> toggleDone(item.id, true));

                    const text = document.createElement('div');
                    text.className = 'todo-text';
                    text.textContent = item.text;

                    const rem = document.createElement('div');
                    rem.className = 'remove-btn';
                    rem.textContent = 'Remove';
                    rem.addEventListener('click', ()=> removeItem(item.id));

                    wrapper.appendChild(checkbox);
                    wrapper.appendChild(text);
                    wrapper.appendChild(rem);

                    todoList.appendChild(wrapper);
                });
            }

            const completedBox = document.getElementById('completedBox');
            if(done.length === 0){
                completedBox.style.display = 'none';
            } else {
                completedBox.style.display = 'block';
                done.forEach((item) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'todo-item';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = true;
                    checkbox.addEventListener('change', ()=> toggleDone(item.id, false));

                    const text = document.createElement('div');
                    text.className = 'todo-text';
                    text.textContent = item.text;
                    text.style.textDecoration = 'line-through';
                    text.style.opacity = '0.7';

                    const rem = document.createElement('div');
                    rem.className = 'remove-btn';
                    rem.textContent = 'Remove';
                    rem.addEventListener('click', ()=> removeItem(item.id));

                    wrapper.appendChild(checkbox);
                    wrapper.appendChild(text);
                    wrapper.appendChild(rem);

                    completedList.appendChild(wrapper);
                });
            }
        }

        function generateId(){ return 'id_' + Date.now() + '_' + Math.floor(Math.random()*10000); }

        function addTodo(text){
            const arr = loadTodos();
            arr.push({ id: generateId(), text: text, done: false });
            saveTodos(arr);
            renderAll();
        }

        function toggleDone(id, toDone){
            const arr = loadTodos();
            const i = arr.findIndex(x => x.id === id);
            if(i === -1) return;
            arr[i].done = toDone;
            saveTodos(arr);
            renderAll();
        }

        function removeItem(id){
            const arr = loadTodos();
            const i = arr.findIndex(x => x.id === id);
            if(i === -1) return;
            arr.splice(i,1);
            saveTodos(arr);
            renderAll();
        }

        function saveFromPopup(){
            const input = todoInput;
            const val = input.value.trim();
            if(!val){
                input.style.background = '#ffecec';
                setTimeout(()=> input.style.background = '#f3f4f6', 350);
                return;
            }
            addTodo(val);
            input.value = '';
            closeBottomPopups();
        }

        // Attach listeners safely
        if (saveBtn) saveBtn.addEventListener('click', saveFromPopup);
        if (todoInput) {
            todoInput.addEventListener('keydown', function(e){
                if(e.key === 'Enter'){ e.preventDefault(); saveFromPopup(); }
            });
        }

        // Utility actions
        function openAbout(){
            // navigate to about page
            window.location.href = "about.html";
        }
        function sendFeedback(){
            window.location.href = "mailto:apps.vishalvaishnav@outlook.com";
        }

        // init
        renderAll();

        // Optional: close on Escape
        document.addEventListener('keydown', (e)=> {
            if(e.key === 'Escape') closeBottomPopups();
        });
    </script>
</body>
</html>